<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2024-08-16 Fri 00:03 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>POPL Lecture notes: Understanding Objects</title>
<meta name="author" content="Venkatesh Choppella" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" type="text/css" href="../../themes/readtheorg/style/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="../../themes/readtheorg/style/css/readtheorg.css"/>
<link rel="stylesheet" type="text/css" href="../../themes/readtheorg/style/css/extra.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../themes/readtheorg/style/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="../../themes/readtheorg/style/js/readtheorg.js"></script>
<script src="../../themes/math/style/js/math.js?config=TeX-AMS_HTML"></script>
<link rel="stylesheet" type="text/css" href="../../themes/math/style/css/math.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<link rel="icon" type="image/png" href="../../themes/popl/style/img/favicon/popl.png" />
<div style="display: none"> \(
% Latex Preamble definitions here (mostly usepackage)
\usepackage%
%[dvipsnames]
{xcolor}
% make sure this is before the loading font packages
\newcommand\hmmax{0}
\newcommand\bmmax{0}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage
%[dvipsnames]
{graphicx}
\usepackage{float}
%\usepackage[numbers]{natbib}
\usepackage[document]{ragged2e}
%
% enumitem doesn't seem to work with beamer
%\usepackage[inline]{enumitem}
\usepackage{wrapfig}
\usepackage{stackrel}
% extensible arrows
\usepackage{extpfeil}
% \usepackage{trfrac}
\usepackage{amsthm}
\usepackage{tikz}
\usepackage{tikz-cd}
\usepackage{tikz}
\usepackage{tikz-qtree}
\usetikzlibrary{automata, positioning, arrows, shapes.geometric}
\usepackage{turnstile}
\usepackage{comment}
%https://tex.stackexchange.com/questions/21334/is-there-a-package-that-has-the-clockwise-gapped-circle-arrow-in-it
% \usepackage{mathbx}
\usepackage{datetime}
\usepackage{datetime2}

%% Also See
%% http://u.cs.biu.ac.il/~tsaban/Pdf/LaTeXCommonErrs.pdf
%% for general tips
\usepackage{listings}
\usepackage{subfigure}
\usepackage{bm}
\usepackage{amsfonts} %% - also included by amssymb
\usepackage{mathpazo} %% - because the OP uses mathpazo, optional
%\usepackage{tufte-latex}
\usepackage{comment}
\usepackage{mathtools}
\usepackage{bussproofs}
\usepackage{hyperref}
%\usepackage{cleveref}
\)</div>
<div style="display: none"> \(
%% Your math definitions here
% \newcommand{\alphaequiv}{{\underset{\raise 0.7em\alpha}{=}}}
\newcommand{\yields}{\Rightarrow}
\newcommand{\derives}{\overset{*}{\yields}}
\newcommand{\alphaequiv}{=_{\alpha}}
\newcommand{\tto}[2]{{\overset{#1}{\underset{#2}{\longrightarrow}}}}
\newcommand{\transitsto}[2]{{\overset{#1}{\underset{#2}{\longrightarrow}}}}
\newcommand{\xtransitsto}[2]{{\underset{#2}{\xrightarrow{#1}}}}
\newcommand{\xtransitsfrom}[2]{{\underset{#2}{\xleftarrow{#1}}}}
\newcommand{\xto}[2]{{\xtransitsto{#1}{#2}}}
\newcommand{\xfrom}[2]{{\xtransitsfrom{#1}{#2}}}
\newcommand{\xreaches}[2]{{\underset{#2}{\xtwoheadrightarrow{#1}}}}
\newcommand{\reaches}[2]{{\underset{#2}{\xtwoheadrightarrow{#1}}}}
%\newcommand{\reaches}[2]{{\overset{#1}{\underset{#2}{\twoheadrightarrow}}}}
%\newcommand{\goesto}[2]{\transitsto{#1}{#2}}
%\newcommand{\betareducesto}{{\underset{\beta}{\rightarrow}}}
\newcommand{\betareducesto}{\rightarrow_{\beta}}
%\newcommand{\etareducesto}{{\underset{\eta}{\rightarrow}}}
\newcommand{\etareducesto}{\rightarrow_{\eta}}
%\newcommand{\betaetareducesto}{{\underset{\beta\ \eta}{\rightarrow}}}
\newcommand{\betaetareducesto}{\rightarrow_{\beta\eta}}
\newcommand{\preducesto}{\rhd}
\newcommand{\psimplifiesto}{\stackrel{\scriptstyle{*}}{\rhd}}
\newcommand{\lreducesto}{\rightsquigarrow}
\newcommand{\lsimplifiesto}{\stackrel{\scriptstyle{*}}{\lreducesto}}
\newcommand{\rewritesto}{\hookrightarrow}
\newcommand{\goesto}[1]{\stackrel{#1}{\rightarrow}}
\newcommand{\xgoesto}[1]{\xrightarrow{#1}}
\newcommand{\reducesto}{\stackrel{}{\rightarrow}}
\newcommand{\simplifiesto}{\stackrel{\scriptstyle{*}}{\rightarrow}}
\newcommand{\connected}[1]{\stackrel{#1}{\leftrightarrow}}
\newcommand{\joins}{\downarrow}
\newcommand{\evaluatesto}{\Longrightarrow}
%\newcommand{\lit}[1]{\hbox{\sf{#1}}}
\newcommand{\lit}[1]{{\sf{#1}}}
\newcommand{\true}{\lit{true}}
\newcommand{\false}{\lit{false}}
\def\Z{\mbox{${\mathbb Z}$}}
\def\N{\mbox{${\mathbb N}$}}
\def\P{\mbox{${\mathbb P}$}}
\def\R{\mbox{${\mathbb R}$}}
\def\T{\mbox{${\mathbb T}$}}
\newcommand{\Rp}{{\mathbb{R}}^+}
\def\Bool{\mbox{${\mathbb B}$}}
\def\Q{\mbox{${\mathbb Q}$}}
\def\sA{\mbox{${\cal A}$}}
\def\sB{\mbox{${\cal B}$}}
\def\sC{\mbox{${\cal C}$}}
\def\sD{\mbox{${\cal D}$}}
\def\sF{\mbox{${\cal F}$}}
\def\sG{\mbox{${\cal G}$}}
\def\sL{\mbox{${\cal L}$}}
\def\sP{\mbox{${\cal P}$}}
\def\sM{\mbox{${\cal M}$}}
\def\sN{\mbox{${\cal N}$}}
\def\sR{\mbox{${\cal R}$}}
\def\sS{\mbox{${\cal S}$}}
\def\sO{\mbox{${\cal O}$}}
\def\sT{\mbox{${\cal T}$}}
\def\sU{\mbox{${\cal U}$}}
\def\th{\mbox{$\widetilde{h}$}}
\def\tg{\mbox{$\widetilde{g}$}}
\def\tP{\mbox{$\widetilde{P}$}}
\def\norm{\mbox{$\parallel$}}
\def\osum{${{\bigcirc}}\!\!\!\!{\rm s}~$}
\def\pf{\noindent {\bf Proof}~~}
\def\exec{\mathit{exec}}
\def\Act{\mathit{A\!ct}}
\def\Traces{\mathit{Traces}}
\def\Spec{\mathit{Spec}}
\def\uns{\mathit{unless}}
\def\ens{\mathit{ensures}}
\def\lto{\mathit{leads\!\!-\!\!to}}
\def\a{\alpha}
\def\b{\beta}
\def\c{\gamma}
\def\d{\delta}
\def\sP{\mbox{${\cal P}$}}
\def\sM{\mbox{${\cal M}$}}
\def\sA{\mbox{${\cal A}$}}
\def\sB{\mbox{${\cal B}$}}
\def\sC{\mbox{${\cal C}$}}
\def\sI{\mbox{${\cal I}$}}
\def\sS{\mbox{${\cal S}$}}
\def\sD{\mbox{${\cal D}$}}
\def\sF{\mbox{${\cal F}$}}
\def\sG{\mbox{${\cal G}$}}
\def\sR{\mbox{${\cal R}$}}
\def\tg{\mbox{$\widetilde{g}$}}
\def\ta{\mbox{$\widetilde{a}$}}
\def\tb{\mbox{$\widetilde{b}$}}
\def\tc{\mbox{$\widetilde{c}$}}
\def\tx{\mbox{$\widetilde{x}$}}
\def\ty{\mbox{$\widetilde{y}$}}
\def\tz{\mbox{$\widetilde{z}$}}
\def\tI{\mbox{$\widetilde{I}$}}
\def\norm{\mbox{$\parallel$}}
\def\sL{\mbox{${\cal L}$}}
\def\sM{\mbox{${\cal M}$}}
\def\sN{\mbox{${\cal N}$}}
\def\th{\mbox{$\widetilde{h}$}}
\def\tg{\mbox{$\widetilde{g}$}}
\def\tP{\mbox{$\widetilde{P}$}}
\def\norm{\mbox{$\parallel$}}
\def\to{\rightarrow}
\def\ov{\overline}
\def\gets{\leftarrow}
\def\too{\longrightarrow}
\def\To{\Rightarrow}
%\def\points{\mapsto}
%\def\yields{\mapsto^{*}}
\def\un{\underline}
\def\vep{$\varepsilon$}
\def\ep{$\epsilon$}
\def\tri{$\bigtriangleup$}
\def\Fi{$F^{\infty}$}
\def\Di{\Delta^{\infty}}
\def\ebox\Box
\def\emp{\emptyset}
\def\leadsto{\rightharpoondown^{*}}

\newcommand{\benum}{\begin{enumerate}}
\newcommand{\eenum}{\end{enumerate}}
\newcommand{\bdes}{\begin{description}}
\newcommand{\edes}{\end{description}}
\newcommand{\bt}{\begin{theorem}}
\newcommand{\et}{\end{theorem}}
\newcommand{\bl}{\begin{lemma}}
\newcommand{\el}{\end{lemma}}
% \newcommand{\bp}{\begin{prop}}
% \newcommand{\ep}{\end{prop}}
\newcommand{\bd}{\begin{defn}}
\newcommand{\ed}{\end{defn}}
\newcommand{\brem}{\begin{remark}}
\newcommand{\erem}{\end{remark}}
\newcommand{\bxr}{\begin{exercise}}
\newcommand{\exr}{\end{exercise}}
\newcommand{\bxm}{\begin{example}}
\newcommand{\exm}{\end{example}}
\newcommand{\beqa}{\begin{eqnarray*}}
\newcommand{\eeqa}{\end{eqnarray*}}
\newcommand{\bc}{\begin{center}}
\newcommand{\ec}{\end{center}}
\newcommand{\bcent}{\begin{center}}
\newcommand{\ecent}{\end{center}}
\newcommand{\la}{\langle}
\newcommand{\ra}{\rangle}
\newcommand{\bcor}{\begin{corollary}}
\newcommand{\ecor}{\end{corollary}}
\newcommand{\bds}{\begin{defns}}
\newcommand{\eds}{\end{defns}}
\newcommand{\brems}{\begin{remarks}}
\newcommand{\erems}{\end{remarks}}
\newcommand{\bxrs}{\begin{exercises}}
\newcommand{\exrs}{\end{exercises}}
\newcommand{\bxms}{\begin{examples}}
\newcommand{\exms}{\end{examples}}
\newcommand{\bfig}{\begin{figure}}
\newcommand{\efig}{\end{figure}}
\newcommand{\set}[1]{\{#1\}}
\newcommand{\pair}[1]{\langle #1\rangle}
\newcommand{\tuple}[1]{\langle #1\rangle}
\newcommand{\size}[1]{| #1 |}
\newcommand{\union}{\cup}
\newcommand{\Union}{\bigcup}
\newcommand{\intersection}{\cap}
\newcommand{\Intersection}{\bigcap}
\newcommand{\B}{\textbf{B}}
%\newcommand{\be}[2]{\begin{equation} \label{#1} \tag{#2} \end{equation}}
\newcommand{\abs}[1]{{\lvert}#1{\rvert}}
\newcommand{\id}[1]{\mathit{#1}}
\newcommand{\pfun}{\rightharpoonup}
%\newcommand{\ra}[1]{\kern-1.5ex\xrightarrow{\ \ #1\ \ }\phantom{}\kern-1.5ex}
%\newcommand{\ras}[1]{\kern-1.5ex\xrightarrow{\ \ \smash{#1}\ \ }\phantom{}\kern-1.5ex}
\newcommand{\da}[1]{\bigg\downarrow\raise.5ex\rlap{\scriptstyle#1}}
\newcommand{\ua}[1]{\bigg\uparrow\raise.5ex\rlap{\scriptstyle#1}}
% \newcommand{\lift}[1]{#1_{\bot}}
\newcommand{\signal}[1]{\tilde{#1}}
\newcommand{\ida}{\stackrel{{\sf def}}{=}}
\newcommand{\eqn}{\doteq}
\newcommand{\deduce}[1]{\sststile{#1}{}}

%% These don't sit very well with MathJax
%% so we don't plan to use theorem like environments
%% in org documents.
%% instead we plan to use headings with
%%  1. property drawers with a CLASS property identifying
%%  the environment
%%  2. A tag with the same name as the CLASS property
%%  In LaTeX export, these turn into (sub)sections.


%% See http://u.cs.biu.ac.il/~tsaban/Pdf/LaTeXCommonErrs.pdf
%% \newtheorem{prop}[thm]{Proposition}
%% \theoremstyle{plain}%default
%% \newtheorem{theorem}{Theorem}[section]
%% \newtheorem{lemma}{Lemma}[section]
%% \newtheorem{corollary}{Corollary}[section]
%% \newtheorem{definition}{Definition}[section]
%% \newtheorem{remark}{Remark}[section]
%% \newtheorem{example}{Example}[section]
%% \newtheorem{exercise}{Exercise}[section]



\newcommand{\less}[1]{#1_{<}}
\newcommand{\pfn}{\rightharpoonup}
\newcommand{\ffn}{\stackrel{{\sf fin}}{\rightharpoonup}}
\newcommand{\stkout}[1]{\ifmmode\text{\sout{\ensuremath{#1}}}\else\sout{#1}\fi}

% Caution: Not supported by MathJax!
% ----------------------------------
% \DeclareMathSymbol{\shortminus}{\mathbin}{AMSa}{"39}


% \usepackage{amsfonts} %% <- also included by amssymb
% \DeclareMathSymbol{\shortminus}{\mathbin}{AMSa}{"39}
\usepackage{mathpazo} %% <- because the OP uses mathpazo, optional



\newcommand{\mbf}[1]{\mathbf{#1}}

\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}
\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}
\newcommand{\rel}{\twoheadrightarrow}
\newcommand{\map}{\rightarrow}

%\newcommand{\fixed}{\boldsymbol{\circlearrowleft}}
\newcommand{\terminal}{\not\xto{}{}}
\newcommand{\fixed}{\bm\circlearrowleft}

\newcommand{\imp}{\rightarrow}
\newcommand{\dimp}{\leftrightarrow}  % double implication
\newcommand{\lequiv}{\Longleftrightarrow} % logical equivalence
\newcommand{\limplies}{\Rightarrow}
\newcommand{\lxor}{\veebar}
\)</div>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="../index.html"> UP </a>
 |
 <a accesskey="H" href="../../index.html"> HOME </a>
</div><div id="content" class="content">
<h1 class="title">POPL Lecture notes: Understanding Objects</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgb4749ea">1. Motivating Objects</a></li>
<li><a href="#org6d7962a">2. Data encapsulation: Objects as closures</a>
<ul>
<li><a href="#orgbd99932">2.1. Example</a></li>
<li><a href="#org7ff5fae">2.2. A naive design of account using a global variable to store state</a>
<ul>
<li><a href="#org68f92a1">2.2.1. Using a Global variable to hold the balance</a></li>
</ul>
</li>
<li><a href="#org9f3c115">2.3. Account designed to use local state</a>
<ul>
<li><a href="#org5df0ca4">2.3.1. Closures close over state variables</a></li>
</ul>
</li>
<li><a href="#org10981ae">2.4. Basic concepts related to objects</a></li>
</ul>
</li>
<li><a href="#org69e04b2">3. Late Binding: Objects as environments</a>
<ul>
<li><a href="#org8c93340">3.1. Object interface</a></li>
<li><a href="#orgfa85ca9">3.2. Implementing a simple object mechanism in Scheme</a></li>
<li><a href="#orgd834194">3.3. Example: bank account</a></li>
<li><a href="#org701e3d0">3.4. Methods</a></li>
<li><a href="#orgadcb503">3.5. Installing methods in the object</a></li>
<li><a href="#org2fd6901">3.6. Defining a  method call protocol</a></li>
</ul>
</li>
<li><a href="#org66832ee">4. Inheritance extension: Objects as extended environments</a>
<ul>
<li>
<ul>
<li><a href="#orga12ea50">4.0.1. Error Object</a></li>
<li><a href="#org0f8762f">4.0.2. Constructing objects with inheritance</a></li>
<li><a href="#org65b3665">4.0.3. Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgffc2ae3">5. Safe dynamic dispatch</a>
<ul>
<li><a href="#orgee07ae1">5.1. An implementation of the bank account using safe objects</a></li>
<li><a href="#orgf650b3a">5.2. Using the closure call protocol for safe objects</a></li>
<li><a href="#org0cba648">5.3. Using the <code>ccall</code> protocol for interacting with the safe account object</a></li>
<li><a href="#org978a894">5.4. Key difference between Methods and Closures</a></li>
<li><a href="#org65c2fbb">5.5. Safety</a></li>
</ul>
</li>
<li><a href="#org6e88036">6. Delegation</a>
<ul>
<li><a href="#org88cc2fb">6.1. Example: a personal account object that extends an account object</a></li>
</ul>
</li>
<li><a href="#org4b4a624">7. Static versus Dynamic Object Oriented languages</a></li>
<li><a href="#org52af5bb">8. Source code</a>
<ul>
<li><a href="#org1dec237">8.1. List of files</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgb4749ea" class="outline-2">
<h2 id="orgb4749ea"><span class="section-number-2">1.</span> Motivating Objects</h2>
<div class="outline-text-2" id="text-1">
<p>
The goal of this set of notes is to understand object-oriented
programming from first principles by building several simple object
systems in Scheme.  Racket Scheme already has a full-fledged object
system in place, but we will not rely on this at all.  We will build
our own object system <i>ab initio</i> relying, instead, on closures and
environments.  So you may want to ensure that you are comfortable with
these ideas first.
</p>

<p>
Objects are entities that hold <i>state</i> in a set of state variables.
The object's state may be accessed and manipulated via the object's
<i>interface</i>.  The interface could consist of identifiers, called
<i>fields</i> or <i>messages</i> that refer to the object's state or functions
that manipulate the state.  Fields that are functions are called
<i>methods</i>.
</p>

<p>
Usually, the object's interface is assumed fixed during the lifetime
of the object, i.e., is not dependent on its state, but this is not
strictly necessary.
</p>

<p>
There are at least three competing, but related, ways to motivate the
idea of objects:
</p>

<dl class="org-dl">
<dt>Data Encapsulation and Invariant Preservation  (<i>Safety</i>)</dt><dd>Objects
enclose data in the form of state variables.  These variables
can change via interactions.  However, the object should be
designed to be safe: that interactions with it should
preserve certain properties (invariants) of the state that
the object encapsulates.</dd>

<dt>Late Binding (<i>Dynamic Dispatch</i>)</dt><dd>Different objects may
respond to different stimuli, also called <i>messages</i>, in
different ways.  Messages are identified through symbols, and
the ability and the freedom to interpret the messages and
respond lies with each object.</dd>

<dt>State and Behaviour Extension (<i>Inheritance and Delegation</i>)</dt><dd>The
behaviour of an object is the relation that determines how
the object responds to a given message.  Extension means the
creation of new entities that inherit state and behaviour
from existing ones.</dd>
</dl>
</div>
</div>

<div id="outline-container-org6d7962a" class="outline-2">
<h2 id="org6d7962a"><span class="section-number-2">2.</span> Data encapsulation: Objects as closures</h2>
<div class="outline-text-2" id="text-2">
<p>
Objects provide mechanisms for persisting data across interactions.
Persistent means that data must have an indefinite extent, i.e.,
indefinite lifetime.  The lifetime must extend beyond the life of the
invocation of functions over them.  Usually, designing the object
involves addressing the invariance of the object's data across
interactions.  Invariance means that properties capturing the data's
semantics are preserved.
</p>
</div>

<div id="outline-container-orgbd99932" class="outline-3">
<h3 id="orgbd99932"><span class="section-number-3">2.1.</span> Example</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Consider the example of balance in a bank account.  The state variable
of this account is the account's balance and it continues to exist
forever as an entity, as long as it is subject to withdrawals or
deposits.
</p>

<p>
The notion of relatedness is best understood in terms of <i>invariants</i>
on data, i.e., what we want true about the data.  For a bank account,
its balance must remain a number greater than equal to zero, i.e.,
<code>balance</code> &gt;= 0 irrespective of how the balance state variable is
manipulated.
</p>
</div>
</div>

<div id="outline-container-org7ff5fae" class="outline-3">
<h3 id="org7ff5fae"><span class="section-number-3">2.2.</span> A naive design of account using a global variable to store state</h3>
<div class="outline-text-3" id="text-2-2">
<p>
In the naive design, the state variable balance is a global variable.
Two other functions <code>deposit</code> and <code>withdraw</code> operate on it.
</p>
</div>

<div id="outline-container-org68f92a1" class="outline-4">
<h4 id="org68f92a1"><span class="section-number-4">2.2.1.</span> Using a Global variable to hold the balance</h4>
<div class="outline-text-4" id="text-2-2-1">
<div class="org-src-container">
<pre class="src src-scheme">;;; *balance* : nat?
(define *balance* 100)  ;; opening balance in account

;;; deposit : nat? -&gt; nat?   
(define (deposit m)   ;; deposit an amount m into the account
  (set! *balance* (+ *balance* m)))

;;; withdraw : nat? -&gt; void?   
(define (withdraw m)
  (if (&lt; *balance* m)
    (error 'account "balance ~a less than  requested withdrawal ~a" *balance* m)
    (set! *balance* (- *balance* m))))
</pre>
</div>

<p>
The problem with this approach is that <code>deposit</code> and <code>withdraw</code>
together are unable to guarantee the invariant about balance, viz.,
that it should be always non-negative.  The reason is that <code>*balance*</code>
is exposed and any <i>other</i> program may set its value to an arbitrary
amount as shown below.
</p>

<div class="org-src-container">
<pre class="src src-scheme">(set! *balance* -500)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9f3c115" class="outline-3">
<h3 id="org9f3c115"><span class="section-number-3">2.3.</span> Account designed to use local state</h3>
<div class="outline-text-3" id="text-2-3">
<p>
The problem above is the uncontrolled (global) scope of the variable
 <code>*balance*</code>.
</p>
</div>
<div id="outline-container-org5df0ca4" class="outline-4">
<h4 id="org5df0ca4"><span class="section-number-4">2.3.1.</span> Closures close over state variables</h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
Controlling scope is best done with closures.  In the code below, an
account is a set of three closures all of which share a common lexical
variable <code>balance</code>.
</p>

<div class="org-src-container">
<pre class="src src-scheme">
  ;; make-account : nat? -&gt; (list procedure? procedure? procedure?)
  (define make-account
    (lambda (opening)
      (let ([balance opening])
        (let ([show  ;; : () -&gt; nat?
                (lambda () balance)]

              [deposit  ;; : nat? -&gt; void?
                (lambda (m)
                  (set! balance (+ balance m)))]

              [withdraw ;; : nat? -&gt; void?
                (lambda (m) 
                  (if (&lt; balance m)
                    (error 'withdraw "not enough balance to withdraw ~a" m)
                    (set! balance (- balance m))))])
          (list show  deposit withdraw)))))

(define acc (make-account 100))
(match-define (list acc-show acc-deposit acc-withdraw) acc)

(require rackunit)
(check-eq? (acc-show) 100 "acc1")
(acc-deposit 200)
(check-eq? (acc-show)  300 "acc2")
(acc-withdraw 300)
(check-eq? (acc-show) 0 "acc3")
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org10981ae" class="outline-3">
<h3 id="org10981ae"><span class="section-number-3">2.4.</span> Basic concepts related to objects</h3>
<div class="outline-text-3" id="text-2-4">
<p>
In object oriented programming, the following concepts are
fundamental:
</p>


<dl class="org-dl">
<dt>Object</dt><dd>An object is a container for a set of <i>state variables</i>.</dd>

<dt>State</dt><dd>The values of the set of state variables encapsulated by
the object.  The state of an object is persistent across
interactions with the object.</dd>

<dt>Construction interface</dt><dd>A specification of how objects are
created in terms of the type signature of its constructors.</dd>

<dt>Interaction Interface</dt><dd>A specification of how one can interact
with the object.  This is specified as a set of <i>method
signatures</i>.</dd>

<dt>Invariant</dt><dd>A set of constraints that are held true across
interactions with the object.</dd>

<dt>Implementation</dt><dd>An implementation of the methods and the
constructors of the object.</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-org69e04b2" class="outline-2">
<h2 id="org69e04b2"><span class="section-number-2">3.</span> Late Binding: Objects as environments</h2>
<div class="outline-text-2" id="text-3">
<p>
Objects are essentially environments that bind identifiers to mutable
cells.  We are already familiar with environments as a way to
understand lexical scoping.  For lexically scoped identifier <code>x</code>, its
denotation is determined statically, by locating its binding
occurrence.  On the other hand, one could specify an environment
explicitly in which <code>x</code> is to be looked up.  Such an environment 
is essentially an object.
</p>

<p>
Recall the functional implementation of environments.  The lookup of a
symbol <code>x</code> in an environment <code>e</code> was simply the function call <code>(e
x)</code>.  This is exactly the interface for  looking up the (value of) a
symbol in an object. 
</p>
</div>

<div id="outline-container-org8c93340" class="outline-3">
<h3 id="org8c93340"><span class="section-number-3">3.1.</span> Object interface</h3>
<div class="outline-text-3" id="text-3-1">
<pre class="example" id="org7c5b5db">
(e 'x)
</pre>

<p>
Looks up the identifier <code>x</code> in the object obtained by evaluating the
<i>expression</i> <code>e</code> and returns the value sitting in the cell to which <code>x</code>
is bound (not the cell itself).
</p>


<pre class="example" id="orgff79302">
(e 'x 5)
</pre>

<p>
Locates the cell to which identifier <code>x</code> is bound (binds <code>x</code> to a new
cell if <code>x</code> is unbound) in the object obtained by evaluating <code>e</code> and
puts in that cell the value 5.  When <code>x</code> is not in the object, we
simply extend the object to contain <code>x</code> in its domain.
</p>
</div>
</div>

<div id="outline-container-orgfa85ca9" class="outline-3">
<h3 id="orgfa85ca9"><span class="section-number-3">3.2.</span> Implementing a simple object mechanism in Scheme</h3>
<div class="outline-text-3" id="text-3-2">
<p>
To implement objects, we want a way to do three things:
</p>

<dl class="org-dl">
<dt>Creation</dt><dd>Create an object.</dd>

<dt>Access</dt><dd>Access to the state variables</dd>

<dt>Modification</dt><dd>Modification the state variables, which include the
flexibility of creating a field when one doesn't
exist.</dd>
</dl>

<p>
We could re-implement the environment data type to do this.  But <i>hash
tables</i> (also called <i>dictionaries</i>) do exactly this.
</p>

<div class="org-src-container">
<pre class="src src-scheme">;;; make-ground-obj : [] -&gt; obj?
(define make-ground-obj
  (lambda () 
    (let ([table (make-hash)])
      (lambda msg
        (match msg  
                                ;; a list with one symbol
          [(list (? symbol? x)) ;; it's a get
            (hash-ref table x
              (lambda ()
                (error "obj: do not know field ~a"  msg)))]

                                  ;; a symbol and a value 
          [(list (? symbol? x) v) ;; it's a set
           (hash-set! table x v)]
          [else (error 'make-ground-obj "invalid object lookup syntax ~a" msg)])))))
</pre>
</div>

<p>
Every object is now a function created using the <code>make-obj</code> function.
The object allows access or mutation of fields.
</p>

<pre class="example" id="org81ce4dc">
(define o (make-ground-obj))

(o 'x 5)  ;; returns void

(o 'x)    ;; returns 5

(o 'y)    ;; Error since y is not a field in o.

</pre>
</div>
</div>


<div id="outline-container-orgd834194" class="outline-3">
<h3 id="orgd834194"><span class="section-number-3">3.3.</span> Example: bank account</h3>
<div class="outline-text-3" id="text-3-3">
<p>
It is now easy to create an object denoting a bank account and
populate it with the field <code>balance</code>.
</p>

<div class="org-src-container">
<pre class="src src-scheme">(require "obj-ground.rkt")
(define a (make-ground-obj))

(require rackunit)
(a 'balance 100)
(check-eq? (a 'balance) 100 "ab100")
</pre>
</div>

<p>
Note that it is just as easy to create and modify any other field
after the object has been created.  
</p>
</div>
</div>

<div id="outline-container-org701e3d0" class="outline-3">
<h3 id="org701e3d0"><span class="section-number-3">3.4.</span> Methods</h3>
<div class="outline-text-3" id="text-3-4">
<p>
A method is a function that operates on an object.  By convention, the
object is taken as the first argument to the method.
</p>

<div class="org-src-container">
<pre class="src src-scheme">(define show-balance
  (lambda (obj)
    (obj 'balance)))

(define deposit
  (lambda (obj m)
    (let ([b (obj 'balance)])
      (obj 'balance (+ b m)))))

(define withdraw
  (lambda (obj m)
    (let ([b (obj 'balance)])
      (if (&lt; b m)
          (error 'withdraw "insufficient balance ~a" b)
        (obj 'balance (- b m))))))
</pre>
</div>

<p>
In some languages, like Python, by <i>convention</i>, the first
formal parameter, which denotes an object, is called <i>self</i>.
Note that <i>self</i> is an identifier, not a keyword.  In languages
like Java and Javascript , the <i>self</i> formal parameter is
implicitly added to the signature of each method, so it is not
an explicitly listed formal parameter.  The origin and role of
<i>self</i> is a source of persistent confusion to the beginning
student of object oriented programming.
</p>
</div>
</div>

<div id="outline-container-orgadcb503" class="outline-3">
<h3 id="orgadcb503"><span class="section-number-3">3.5.</span> Installing methods in the object</h3>
<div class="outline-text-3" id="text-3-5">
<p>
The methods defined above may themselves be installed as fields
of the object <code>a</code>.
</p>

<div class="org-src-container">
<pre class="src src-scheme">(a 'show-balance show-balance)
(a 'deposit deposit)
(a 'withdraw withdraw)
</pre>
</div>

<p>
To protocol to invoke methods, shown below, is admittedly awkward:
</p>

<div class="org-src-container">
<pre class="src src-scheme">((a 'deposit) a 100)
</pre>
</div>
</div>
</div>


<div id="outline-container-org2fd6901" class="outline-3">
<h3 id="org2fd6901"><span class="section-number-3">3.6.</span> Defining a  method call protocol</h3>
<div class="outline-text-3" id="text-3-6">
<p>
The function <code>mcall</code>, shown below  protocol simplifies the application of methods:
</p>

<div class="org-src-container">
<pre class="src src-scheme">(define mcall
  (lambda (obj name . args)
    (apply (obj name) (cons obj args))))
</pre>
</div>

<p>
We can now use <code>mcall</code> to do a  method call on the object <code>a</code>. 
</p>

<div class="org-src-container">
<pre class="src src-scheme">(require "mcall.rkt")
(mcall a 'deposit 300)
(mcall a 'show-balance)
(mcall a 'withdraw 200)
(mcall a 'show-balance)
</pre>
</div>

<p>
Note that in the object <code>a</code>, the field <code>balance</code> is exposed.  A call
<code>(a 'b -100)</code>, for example, is all that is needed to break <code>a</code>'s
invariant. 
</p>

<p>
We will attend to this problem shortly, but first let us examine the
third motivation for objects.
</p>
</div>
</div>
</div>

<div id="outline-container-org66832ee" class="outline-2">
<h2 id="org66832ee"><span class="section-number-2">4.</span> Inheritance extension: Objects as extended environments</h2>
<div class="outline-text-2" id="text-4">
<p>
The view of objects as environments easily lends itself to the idea of
<i>extension of implementation</i>, sometimes erroneously referred to as
code reuse.  One way of facilitating extension of implementation is
through <i>inheritance</i>.  An object may be created to inherit another
existing object. An object has its own fields that may override the
fields of the parent object from which it inherits.  Again, thinking
of objects as environments helps, because inheritance is just like
composition of environments.
</p>
</div>

<div id="outline-container-orga12ea50" class="outline-4">
<h4 id="orga12ea50"><span class="section-number-4">4.0.1.</span> Error Object</h4>
<div class="outline-text-4" id="text-4-0-1">
<p>
This object is the empty object, with no fields.  Any 
</p>
<div class="org-src-container">
<pre class="src src-scheme">
(define error-obj
  (lambda (msg . args)
    (error 'dispatch "no field ~a" msg)))

</pre>
</div>
</div>
</div>

<div id="outline-container-org0f8762f" class="outline-4">
<h4 id="org0f8762f"><span class="section-number-4">4.0.2.</span> Constructing objects with inheritance</h4>
<div class="outline-text-4" id="text-4-0-2">
<p>
Now, an object may have a parent object when it is constructed.  The
code for this available in the racket source file <a href="./obj.rkt">./obj.rkt</a>
</p>

<div class="org-src-container">
<pre class="src src-scheme">(define make-obj
  (lambda maybe-parent
    (let ([delegate (get-arg-or-default maybe-parent error-obj)])
      (let ([table (make-hash)])
        (lambda msg
           (match msg  

             [(list (? symbol? x)) ;; a list with one symbol
               (hash-ref table x   ;; ;; it's a get
                 (lambda ()
                   (delegate x)))] ;; look up x in the delegate

             [(list (? symbol? x) v) ;; it's  a set
              (hash-set! table x v)]

             [else (error 'make-obj "invalid object lookup syntax ~a" msg)]))))))

(define get-arg-or-default
  (lambda (args default)
    (if (null? args)
      default
      (car args))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org65b3665" class="outline-4">
<h4 id="org65b3665"><span class="section-number-4">4.0.3.</span> Examples</h4>
<div class="outline-text-4" id="text-4-0-3">
<div class="org-src-container">
<pre class="src src-scheme">
;;; demonstrating inheritance
;;; -------------------------
(define b (make-obj))  ;; base object
(b 'x 5)  ;; install the binding (x 5) in b
(define c (make-obj b)) ;; c inherits from b
(require rackunit)

;; install the binding (y 7) in c
(c 'y 7)  
;; return y's binding =&gt; 7
(check-eq? (c 'y) 7 "c7")
;; return x's binding =&gt; 5
(check-eq? (c 'x) 5 "c5")
;; create the binding (x 3) in c
(c 'x 3)  
;; =&gt; 3
(check-eq? (c 'x) 3 "c3")
;; =&gt; 5  b's binding for x remains unchanged
(check-eq? (b 'x) 5 "b5")
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgffc2ae3" class="outline-2">
<h2 id="orgffc2ae3"><span class="section-number-2">5.</span> Safe dynamic dispatch</h2>
<div class="outline-text-2" id="text-5">
<p>
We have seen three views of objects so far: The first treats
an object as a collection of functions that together share
private, i.e., encapsulated state.  The second shows how
objects are ground (non-extended) environments that
facilitate dynamic dispatch.  The third builds on the second
and allows objects to be viewed as extended environments.
</p>

<p>
In this section, we show how to combine dynamic dispatch with
encapsulation.  The result is an implementation of an object system
that allows the creation of safe objects, i.e., objects that preserve
their invariants.  The encapsulation is achieved via closures.  The
dynamic dispatch is achieved by installing the closures against field
names in the object.
</p>
</div>

<div id="outline-container-orgee07ae1" class="outline-3">
<h3 id="orgee07ae1"><span class="section-number-3">5.1.</span> An implementation of the bank account using safe objects</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<pre class="src src-scheme">;;; make-account: nat? -&gt; obj?
(define make-account
  (lambda (initial-balance)
    (let ([b initial-balance])
      (let (
            ;; show-balance : () -&gt; nat?
            [show (lambda ()
                    b)]

            ;; deposit : nat? -&gt; nat?
            [deposit (lambda (m)
                       (set! b (+ b m)))]

            ;; withdraw : nat? -&gt; void?
            [withdraw
              (lambda (m) 
                (if (&lt; b m)
                  (error 'withdraw "not enough balance: ~a" m)
                  (set! b (- b m))))])))))

      (let ([o (make-obj)])
        (o 'show show)
        (o 'deposit deposit)
        (o 'withdraw withdraw)
        o)
</pre>
</div>

<p>
Note that the lexical variable <code>b</code>, denoting balance is not accessible
from outside the object.
</p>

<div class="org-src-container">
<pre class="src src-scheme">(require rackunit)

(define a (make-account 100))
;; ((a 'show))  =&gt; 100
(check-eq? ((a 'show)) 100 "a1")

((a 'deposit) 200)

;; ((a 'show)) ; =&gt; 300
(check-eq? ((a 'show)) 300 "a2")
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf650b3a" class="outline-3">
<h3 id="orgf650b3a"><span class="section-number-3">5.2.</span> Using the closure call protocol for safe objects</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Again, the interface for calling the closures can be made simpler.
The <code>ccall</code> (<i>closure-call</i> or <i>closed-call</i>) protocol shown below
cleans things up a little bit.  (We called this <code>send</code> in an earlier
version of the notes).
</p>

<div class="org-src-container">
<pre class="src src-scheme">
;;; ccall.rkt
(define ccall
  (lambda (obj fn-id . args)
    (let ([fn (obj fn-id)])
      (apply fn args))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0cba648" class="outline-3">
<h3 id="org0cba648"><span class="section-number-3">5.3.</span> Using the <code>ccall</code> protocol for interacting with the safe account object</h3>
<div class="outline-text-3" id="text-5-3">
<p>
The account object <code>a</code> now admits interaction via  <code>ccall</code>:
</p>

<div class="org-src-container">
<pre class="src src-scheme">;;; back in account-safe.rkt
(require "ccall.rkt")

;; (ccall a 'show) =&gt; 300
(check-eq? (ccall a 'show) 300 "a3")

(ccall a 'deposit 200)

;; (ccall a 'show) ; =&gt; 500
(check-eq? (ccall a 'show) 500 "a4")
</pre>
</div>
</div>
</div>

<div id="outline-container-org978a894" class="outline-3">
<h3 id="org978a894"><span class="section-number-3">5.4.</span> Key difference between Methods and Closures</h3>
<div class="outline-text-3" id="text-5-4">
<p>
Notice the key difference between methods and closures.  Methods do
not need to close over the state variables of the object in which they
are installed.  Instead, they access the state variables of the object
passed to them (identified by <code>this</code>).  Hiding the state variable will
render the methods useless.  In the above implementation of
<code>make-account</code>, however, closures denoted by the functions <code>show</code>,
<code>deposit</code> and <code>withdraw</code> close over the local state variable <code>b</code> of
the specific object in that holds both the state variable and the
function.
</p>
</div>
</div>


<div id="outline-container-org65c2fbb" class="outline-3">
<h3 id="org65c2fbb"><span class="section-number-3">5.5.</span> Safety</h3>
<div class="outline-text-3" id="text-5-5">
<p>
Safety refers to the property that the object's invariants are
preserved during the entire lifetime of the object: from its creation
through its interaction with other objects and till its ultimate
deletion.  Note that the creation of the object via a legitimate call
to <code>make-account</code> (i.e., a call where the argument that initializes
the balance amount is a natural number) ensures that the object's
invariant (viz., the balance should be a natural) is maintained.  All
calls of the account object's methods preserve this invariant.  Even
if the methods themselves were destroyed, e.g., by setting the fields
<code>show</code>, <code>deposit</code> or <code>withdraw</code> to arbitrary values, the invariants on
the state variables would still be preserved.  This is because the
state variables will remain inaccessible to any new values of the
method fields.  
</p>

<p>
The only limitation seems to be the extensibility of the object.
Although new methods could be installed in the object, these new
methods would have no way of accessing the existing private state
variables of the object.
</p>
</div>
</div>
</div>

<div id="outline-container-org6e88036" class="outline-2">
<h2 id="org6e88036"><span class="section-number-2">6.</span> Delegation</h2>
<div class="outline-text-2" id="text-6">
<p>
A safe object extends behaviour by delegation.  It mimics the
interface of the parent object by including the parent as one of its
private fields.  However it overrides certain methods of the parent by
redefining them.  The body of the overriding method optionally calls
the parent's method, i.e., delegates to it.  Notice that the object
still does not have access to its parent's state; only its methods.
</p>
</div>


<div id="outline-container-org88cc2fb" class="outline-3">
<h3 id="org88cc2fb"><span class="section-number-3">6.1.</span> Example: a personal account object that extends an account object</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">
<pre class="src src-scheme">
;;; make-personal-account : string? init-balance -&gt; personal-account?
(define make-personal-account
  (lambda (name init-balance)
    (let ([person-name name]
          [a (make-account init-balance)]
          [b (make-obj)])

           ;; withdraw : nat? -&gt; void?
           ;; throws "amount too small" error 
      (let ([withdraw (lambda (v)
                        (if (&lt; v 50)
                          (error 'withdraw "amount ~a too small" v)
                          (ccall a 'withdraw v)))]

            ;; show : () -&gt; nat?
            [show (lambda ()
                    (let ([b (ccall a 'show)])
                      (printf "~a has balance ~a~n" person-name b)
                      b))])
        (b 'show show)
        (b 'withdraw withdraw)
        (b 'deposit (a 'deposit)) ; use a's deposit method
        b))))

   (define b (make-personal-account "Ajay" 500))
   (require "ccall.rkt")
   (require rackunit)

   ;;; (ccall b 'show) =&gt; 500
   (check-eq? (ccall b 'show) 500 "b1")

   (ccall b 'deposit 100)

   ;;; (ccall b 'show) =&gt; 600
   (check-eq? (ccall b 'show) 600 "b2")


   ;;; (ccall b 'withdraw 25) raises error
   (check-exn exn:fail?
     (lambda ()
       (ccall b 'withdraw 5))
     "b3")


   (ccall b 'withdraw 200)
   ;;; (ccall b 'show) =&gt; 400
   (check-eq? (ccall b 'show) 400 "b4")

</pre>
</div>


<p>
Note that in delegation a 'child' object may delegate to multiple
'parent' objects.  The child object is not obligated to export the
entire interface of the parent object.  The child may add more
methods, but these would not be privy to the parent's state variables.
</p>
</div>
</div>
</div>

<div id="outline-container-org4b4a624" class="outline-2">
<h2 id="org4b4a624"><span class="section-number-2">7.</span> Static versus Dynamic Object Oriented languages</h2>
<div class="outline-text-2" id="text-7">
<p>
In static object oriented languages like Java, the interface of an
object is fixed once it is defined.  In these languages, new state
variables and/or methods or closures can not be installed in the
object once it is created.  This restriction has advantages in terms
of safety.
</p>

<p>
In dynamic object languages, like Javascript, objects admit the
addition of methods and state variables once created.  However, such
languages lack safety because they do not have a way to encapsulate
their state variables. 
</p>

<p>
So, it seems that one needs to choose between safety and dynamic
extensibility of the object's state and/or interface.
</p>

<p>
The safe object paradigm regime presented in this chapter is a
reasonable middle ground.  Private state variables and the closures
that operate on them need to be defined at the time of the object's
creation.  Any subsequent addition to the object's fields can not
influence the object's state variables.  Additionally, Delegation
allows an object's behaviour or implementation to be extended in a
safe way. 
</p>

<p>
For dynamic object oriented languages like Javascript, it is best to
construct safe objects and extend them using delegations.  We will
have more to say on this when we study the object mechanism of
Javascript in detail later.
</p>
</div>
</div>

<div id="outline-container-org52af5bb" class="outline-2">
<h2 id="org52af5bb"><span class="section-number-2">8.</span> Source code</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-org1dec237" class="outline-3">
<h3 id="org1dec237"><span class="section-number-3">8.1.</span> List of files</h3>
<div class="outline-text-3" id="text-8-1">
<dl class="org-dl">
<dt><a href="./account-global.rkt">./account-global.rkt</a></dt><dd>Implementation of account as a set of
functions sharing a global state variable.</dd>

<dt><a href="./account-closures.rkt">./account-closures.rkt</a></dt><dd>Implementation of account as a set of
closures, i.e., functions closing over a local state variable.</dd>

<dt><a href="./account-ground-obj.rkt">./account-ground-obj.rkt</a></dt><dd>Implementation of account as a ground
object with state variables and methods.  The state variable is
vulnerable to mutation.</dd>

<dt>account-inherited.rkt</dt><dd>This is left as an exercise.</dd>

<dt><a href="./account-safe.rkt">./account-safe.rkt</a></dt><dd>Implementation of account using safe objects,
i.e., objects with private state and an interface consisting of
closures.</dd>

<dt><a href="./account-delegate.rkt">./account-delegate.rkt</a></dt><dd>Implementation of personal-account using
safe objects and delegation.</dd>

<dt><a href="./obj-ground.rkt">./obj-ground.rkt</a></dt><dd>Implementation of ground objects.</dd>

<dt><a href="./obj.rkt">./obj.rkt</a></dt><dd>Implementation of objects that support
inheritance.</dd>

<dt><a href="./mcall.rkt">./mcall.rkt</a></dt><dd>Implementation of the method call protocol.</dd>

<dt><a href="./ccall.rkt">./ccall.rkt</a></dt><dd>Implementation of the closure call protocol.</dd>
</dl>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Venkatesh Choppella</p>
<p class="date">Created: 2024-08-16 Fri 00:03</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
