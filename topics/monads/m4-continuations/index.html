<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2024-08-15 Thu 16:56 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>m4-continuations: Monadic Evaluator with continuations</title>
<meta name="author" content="noteness" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="../index.html"> UP </a>
 |
 <a accesskey="H" href="../../../index.html"> HOME </a>
</div><div id="content" class="content">
<h1 class="title">m4-continuations: Monadic Evaluator with continuations</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org231e519">1. Introduction</a></li>
<li><a href="#org8ae84b9">2. Semantic domains</a></li>
<li><a href="#org463300b">3. Unit and composition operators</a></li>
<li><a href="#org661a3d8">4. Evaluator</a></li>
<li><a href="#orgeed8258">5. Running and unit tests</a></li>
<li><a href="#org2385c06">6. Source code</a></li>
</ul>
</div>
</div>

<div id="outline-container-org231e519" class="outline-2">
<h2 id="org231e519"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
The monadic variant of the continuation
interpreter starts out with the same term
structure.
</p>

<div class="org-src-container">
<pre class="src src-scheme">#lang racket
(provide (all-defined-out))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-scheme">(require eopl/eopl)
(require racket/contract)

(define-datatype term term?
  [con (int integer?)]
  [div (num term?) (den term?)])

(define :
  (lambda (f v1 v2)
    ((f v1) v2)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8ae84b9" class="outline-2">
<h2 id="org8ae84b9"><span class="section-number-2">2.</span> Semantic domains</h2>
<div class="outline-text-2" id="text-2">
<p>
The semantic domains are identical to the one
in continuation interpreter <a href="../v4-continutations/index.html">v4-continuations</a>.   
</p>

<div class="org-src-container">
<pre class="src src-scheme">;;; Semantic Domains
(define msg? string?)
(define value? integer?)

;;; type answer? = msg? + value?
(define answer? (or/c msg? value?))

;;; type continuation? = value? -&gt; answer?
(define continuation? (value? . -&gt; . answer?))

;;; type computation? = continuation? -&gt; answer?
(define computation? (continuation? . -&gt; . answer?))
</pre>
</div>
</div>
</div>


<div id="outline-container-org463300b" class="outline-2">
<h2 id="org463300b"><span class="section-number-2">3.</span> Unit and composition operators</h2>
<div class="outline-text-2" id="text-3">
<p>
The <code>unit</code> operator takes a value and turns it
into a computation.  
</p>

<div class="org-src-container">
<pre class="src src-scheme">;;;  unit : value? -&gt; computation?
(define unit
  (lambda (a)   ; value?
    (lambda (c) ; continuation?
      (c a))))  ; answer?
</pre>
</div>

<p>
The <code>raise</code> function takes a message string and
turns it into a computation, i.e, a function
that takes a continuation and returns an answer:
</p>

<div class="org-src-container">
<pre class="src src-scheme">;;; raise : string? -&gt; computation?
(define raise
  (lambda (msg) ; string?
    (lambda (c) ; continuation?
      msg)))    ; answer?
</pre>
</div>

<p>
The composition operator <code>o</code> takes a computation
<code>m</code>, a value receiver <code>k</code> and returns a
computation.  This computation takes a
continuation <code>c</code> and returns an answer.  The
answer is obtained by applying <code>m</code> to a new
continuation that takes a value <code>a</code>.  The result
is the execution of the receiver with the value
<code>a</code> and the continuation <code>c</code>.
</p>

<div class="org-src-container">
<pre class="src src-scheme">;;; o : computation? -&gt; (value? -&gt; computation?) -&gt;  computation?
(define o
  (lambda (m)         ; m : computation?
    (lambda (k)       ; k : value? -&gt; computation?
      (lambda (c)     ; c : continuation?
        (m
          (lambda (a) ; a : value? 
            (: k a c))))))) ; answer?
</pre>
</div>
</div>
</div>


<div id="outline-container-org661a3d8" class="outline-2">
<h2 id="org661a3d8"><span class="section-number-2">4.</span> Evaluator</h2>
<div class="outline-text-2" id="text-4">
<p>
The evaluator is now defined in terms of
<code>unit</code>, <code>raise</code> and the compostion operator
<code>o</code>. 
</p>

<div class="org-src-container">
<pre class="src src-scheme">;;; eval-term :  term? -&gt; computation?
(define eval-term
  (lambda (t)
    (cases term t
      [con (int) (unit int)]
      [div (num den)
        (: o (eval-term num)
          (lambda (n)
            (: o (eval-term den)
              (lambda (d)
                (if (= d 0)
                  (raise "divide by zero")
                  (unit (quotient n d)))))))])))
</pre>
</div>

<p>
Notice that it is identical to the evaluator in
<a href="../m1-exceptions/index.html">m1-exceptions</a>!  The definition of computation
abstract data type in each case adequately hides
the details of the 'plumbing', in one case
pushing the exceptions upward, and in other
case, escaping with the exception.
</p>
</div>
</div>

<div id="outline-container-orgeed8258" class="outline-2">
<h2 id="orgeed8258"><span class="section-number-2">5.</span> Running and unit tests</h2>
<div class="outline-text-2" id="text-5">
<p>
To run this code we need a top-level
continuation and a =run=function.
</p>

<div class="org-src-container">
<pre class="src src-scheme">
;;; tc : continuation?
(define tc
  (lambda (v)
    v))

;;; run : term? -&gt; answer?
(define run
  (lambda (t)
    (: eval-term t tc)))


;;; Testing

;;; Racket's unit testing framework
(require rackunit)

(check-equal? (run (con 5)) 5 "run: 5 test")
(check-equal? (run (div (con 5) (con 3)))  1 "run: 5 test")
(check-equal? (run (div (con 5) (con 0))) "divide by zero" "run: divide by zero test1")
(check-equal? (run (div (con 7) (div (con 5) (con 0)))) "divide by zero" "run: divide by zero test2")
</pre>
</div>
</div>
</div>


<div id="outline-container-org2385c06" class="outline-2">
<h2 id="org2385c06"><span class="section-number-2">6.</span> Source code</h2>
<div class="outline-text-2" id="text-6">
<p>
<a href="./m4-continuations.rkt">m4-continuations.rkt</a>
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: noteness</p>
<p class="date">Created: 2024-08-15 Thu 16:56</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
